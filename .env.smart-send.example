# ============================================================================
# SMART SEND - INTELLIGENT ADAPTIVE SCALING CONFIGURATION
# ============================================================================
#
# This file contains configuration for the intelligent adaptive scaling system
# for WhatsApp status/story batch sending.
#
# The system:
# - Monitors batch performance (timing, success rate)
# - Learns per-session optimal batch sizes
# - Skips ramping on subsequent sends when proven batch size is known
# - Dynamically scales up (faster) or down (slower) based on network conditions
#
# Copy this to your .env file or set these environment variables
# ============================================================================

# ============================================================================
# PERFORMANCE THRESHOLDS
# ============================================================================

# Fast batch threshold (milliseconds)
# If a batch completes in LESS than this time, it's considered "fast"
# Fast batches may trigger dynamic scaling (skip ahead to larger batch sizes)
# Default: 2000ms (2 seconds)
SMART_SEND_FAST_THRESHOLD_MS=2000

# Slow batch threshold (milliseconds)
# If a batch takes MORE than this time, it's considered "slow"
# Slow batches may trigger scaling down (use smaller batch sizes)
# Default: 10000ms (10 seconds)
SMART_SEND_SLOW_THRESHOLD_MS=10000

# Minimum success rate
# Batches must succeed at least this percentage to scale up
# Default: 0.95 (95%)
SMART_SEND_MIN_SUCCESS_RATE=0.95

# ============================================================================
# SESSION LEARNING
# ============================================================================

# Enable session learning
# If true, system remembers the max successful batch size per session
# On next send, skips ramping and jumps directly to proven batch size
# Default: true
SMART_SEND_ENABLE_LEARNING=true

# Session memory TTL (hours)
# How long to remember session history
# After this time, session history expires and system starts fresh
# Default: 24 hours
SMART_SEND_MEMORY_TTL_HOURS=24

# ============================================================================
# BATCH SIZE LIMITS
# ============================================================================

# Maximum batch size
# Never send more than this many recipients in a single batch
# Default: 10000
SMART_SEND_MAX_BATCH_SIZE=10000

# ============================================================================
# EXAMPLES
# ============================================================================

# Example 1: Conservative settings (prioritize reliability)
# SMART_SEND_FAST_THRESHOLD_MS=1000
# SMART_SEND_SLOW_THRESHOLD_MS=5000
# SMART_SEND_MIN_SUCCESS_RATE=0.98
# SMART_SEND_MAX_BATCH_SIZE=5000

# Example 2: Aggressive settings (prioritize speed)
# SMART_SEND_FAST_THRESHOLD_MS=3000
# SMART_SEND_SLOW_THRESHOLD_MS=15000
# SMART_SEND_MIN_SUCCESS_RATE=0.90
# SMART_SEND_MAX_BATCH_SIZE=15000

# Example 3: Testing mode (short memory, disable learning)
# SMART_SEND_ENABLE_LEARNING=false
# SMART_SEND_MEMORY_TTL_HOURS=1

# ============================================================================
# BEHAVIOR EXAMPLES
# ============================================================================

# Scenario 1: First send (no history)
# Recipients: 5000
# Flow: 1 ‚Üí 100 [800ms FAST] ‚Üí skip to 1000 [1500ms FAST] ‚Üí skip to 4000 [3500ms] ‚Üí rest
# Result: Completed in 5 batches, stores maxProvenBatchSize=4000

# Scenario 2: Second send (with history)
# Recipients: 5000
# History: maxProvenBatchSize=4000
# Flow: 1 ‚Üí 4000 [3200ms] ‚Üí rest
# Result: Completed in 3 batches! Skipped ramping! üöÄ

# Scenario 3: Network issues
# Recipients: 10000
# History: maxProvenBatchSize=5000
# Flow: 1 ‚Üí 5000 [15000ms SLOW] ‚ùå ‚Üí scale down to 2000 [2500ms] ‚úÖ ‚Üí 4000 [4200ms] ‚úÖ ‚Üí rest
# Result: Adapted to network conditions, updated maxProvenBatchSize=4000

# ============================================================================
# MONITORING
# ============================================================================

# The system logs detailed performance metrics:
# - Batch size and duration for each batch
# - Performance classification (FAST, NORMAL, SLOW)
# - Session learning updates (max proven batch size changes)
# - Dynamic scaling suggestions

# Check your logs for messages like:
# - "Smart send: Batch sent successfully" - shows batch performance
# - "Updated max proven batch size" - shows learning progress
# - "Using session history - skipping to proven batch size" - shows optimization
# - "Fast batch detected - skipping ahead!" - shows dynamic scaling

# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# If batches are timing out:
# - Increase SMART_SEND_SLOW_THRESHOLD_MS
# - Decrease SMART_SEND_MAX_BATCH_SIZE
# - Set more conservative thresholds

# If system is too slow:
# - Decrease SMART_SEND_FAST_THRESHOLD_MS
# - Increase SMART_SEND_MAX_BATCH_SIZE
# - Use more aggressive thresholds

# If session learning not working:
# - Check SMART_SEND_ENABLE_LEARNING=true
# - Check SMART_SEND_MEMORY_TTL_HOURS is appropriate
# - Check logs for "Session history expired" messages

# To reset session learning:
# - Restart the server (in-memory storage)
# - Or wait for TTL to expire
